Simple cognitive radio example
===================

iMinds
-----

The 'cr_application.ns' file describes the topology of the 4 USRP and 1 host server on the testbed.
The 'cr_application.grc' file contains a pair of cognitive USRP tranceivers, and an interferer. The cognitive tranceivers are similar to the implementation in basic tx and rx, except that their frequencies are dynamically adapted. To make the flow graph more compact, the packet generation part is stores in the hirarchical block 'Packet Gen', and the clock syncronization part is stored in the hierarchical block 'Synchronization Blocks', implemented in the packet_gen.grc and sync_blocks.grc respectively.
The 'cr_application.png' file contains a screenshot of the GRC flow graph.
The 'usrpse_wrap.rb' file is a ruby wrapper which calls the 'usrpse_sweeping' that stores the spectrum information into a OML database periodically 
The '*.py' files are the python files automatically generated by GRC.


Requirements:

  * [Install Open VPN client](https://openvpn.net/index.php/open-source/downloads.html)
  * [Request an w-iLab.t testbed account](http://ilabt.iminds.be/gettingstarted)
  * [Basic knowledge of the w-iLab.t Zwijnaarde testbed](http://ilabt.iminds.be/node/93)
  * [Basic knowledge of using USRP in w-iLab.t Zwijnaarde testbed](http://doc.ilabt.iminds.be/ilabt-documentation/wilabfacility.html#using-the-usrp-devices)
  * [Followed the BasicTx and BasicRx tutorials]

To run the cr application:

    $ reserve 4 USRP's and 1 server (must be server5P) on the testbed reservation page
    $ define an emulab experiment using the cr_application.ns file (if it does not exist), adapt the USRP and server according to the reservation and swap in your experiment
    $ log into the reserved server and verify the connection between the server and each USRP via the 'uhd_usrp_probe' command
    $ start the usrp spectrum sensing application by running (adapt the ip address to one of the USRP's you reserved): 
        ./usrpse_wrap.rb --std ZIGBEE -m MAX -o OML -e test_crew --args 192.168.30.2  
    $ open an additional terminal and log onto the reserved server with your w-iLab.t account graphically (with -X option if using ssh client)
    $ launch GRC by running the command: gnuradio-companion
    $ open the 'packet_gen.grc' and the 'sync_blocks.grc' with GRC, compile the graphs (this will generate the .py file in the .grc_gnuracio folder under your home directory)
    $ restart GRC (this will force GRC to reload the new blocks)
    $ open the 'cr_application.grc' with GRC, adapt the IP address of the USRP's according to the reservation
    $ execute the flow graph with the "run" button, after a while you should observe 100% packet reception rate from the GUI 
    $ use the slider to change the interfer's frequency, you should observe:
         when the interfer's frequency overlaps with the the CR tranceivers, the packet reception rate of the secondary tranceivers drops 
         the secondary tranceivers jumps to a new channel automatically and the packet reception rate recovers to normal level

This .grc file builds upon the basic tx and rx application. Hence the common elements are ommited, only the additonal blocks used for dynamic channel configuration are described here:
  * db_channel_selector
    * Queries the database for a new frequency when the bit error rate is lower than a specified threshold
  * Function probe
    * It is a call back function that updates the frequency parameters in the secondary USRP tranceivers
  * Random Source
    * Provides data to transmit for the interfer 
  * GFSK Mod
    * Modulates the bits into symbols for the interfer
