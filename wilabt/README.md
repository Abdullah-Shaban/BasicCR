Simple transmitter example
===================

iMinds
-----

The 'cr_application.ns' file describes the topology of the 4 USRP and 1 host server on the testbed.
The 'cr_application.grc' file contains a pair of cognitive USRP tranceivers, and an additional USRP as Primary transmitter in GNU Radio Companion (GRC). The cognitive tranceivers are similar to the implementation in basic tx and rx, except that their frequencies are dynamically.
The 'cr_application.png' file contains a screenshot of the GRC flow graph.
The 'cr_application.py' file is the python file automatically generated by GRC.
The 'usrpse_sweeping' is a binary file that produces spectrum information based on samples from USRP
The 'usrpse_wrap.rb' file is a ruby wrapper that stores the spectrum information into a OML database periodically

Requirements:

  * [Install Open VPN client](https://openvpn.net/index.php/open-source/downloads.html)
  * [Request an w-iLab.t testbed account](http://ilabt.iminds.be/gettingstarted)
  * [Basic knowledge of the w-iLab.t Zwijnaarde testbed](http://ilabt.iminds.be/node/93)
  * [Basic knowledge of using USRP in w-iLab.t Zwijnaarde testbed](http://doc.ilabt.iminds.be/ilabt-documentation/wilabfacility.html#using-the-usrp-devices)

To run the cr application:

    $ reserve 4 USRP's and 1 server (must be server5P) on the testbed reservation page
    $ define an emulab experiment using the cr_application.ns file (if it does not exist), adapt the USRP and server according to reservation and swap in the experiment
    $ log onto the reserved server and verify the connection between the server and each USRP via the 'uhd_usrp_probe' command
    $ start the usrp spectrum sensing application by running: 
        ./usrpse_wrap.rb --std ZIGBEE -m MAX -o OML -e test_crew --args 192.168.10.2
        Note: adapt the ip address to one of the USRP's you reserved     
    $ open an additional terminal and log onto the reserved server with your w-iLab.t account graphically (with -X option if using ssh client)
    $ launch GRC by running the command: gnuradio-companion
    $ open the 'cr_application.grc' with GRC, adapt the IP address of the USRP's according to the reservation
    $ execute the flow graph with the "run" button 
    $ alternatively we can directly run the python file without using GRC to start the transmission. 
    $ now you should be able to control the primary transmitter's frequency and observe that when the primary transmitter's frequency overlaps with the the CR tranceivers, the bit error rate of the CR  tranceivers will drop, therefore they will jump to the next best channel according to the information of the database, afterwards the bit error rate will return to zero again. 

This .grc file builds upon the basic tx and rx application. Hence the common elements are ommited, only the additonal blocks are described here:
  * Random source
    * Provides bits to the modulator of the primary transmitter
  * GPSK Mod
    * Performs the GPSK modulation for the primary transmitter
  * USRP sink
    * Sends the samples from the GPSK modulator to USRP and transmits over the air
  * Error rate
    * Calculates the bit error rate of the secondary tranceivers 
  * db_channel_selector
    * Queries the database for a new frequency when the bit error rate is lower than a specified threshold

